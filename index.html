<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LLM Observability Demo</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Load Configuration First -->
    <script src="config.js"></script>

    <!-- Datadog RUM SDK -->
    <script src="https://www.datadoghq-browser-agent.com/datadog-rum-v4.js" crossorigin="anonymous"></script>
    <script src="https://www.datadoghq-browser-agent.com/datadog-logs-v4.js" crossorigin="anonymous"></script>

    <!-- Initialize Datadog RUM with Hardcoded Configuration -->
    <script>
        (function() {
            // Hardcoded Datadog RUM configuration (safe to expose publicly)
            const DATADOG_CONFIG = {
                clientToken: 'pub941f8b1659ac0af8597b9c41a0cfe121', // Public client token - safe to expose
                applicationId: 'fde3bfb4-cc7c-49ad-82c2-9fed18ce298c', // Public application ID - safe to expose
                site: 'datadoghq.com', // Datadog site
                service: 'llm-observability-demo',
                env: 'production',
                version: '1.0.0',
                sessionSampleRate: 100,
                sessionReplaySampleRate: 20,
                trackUserInteractions: true,
                trackResources: true,
                trackLongTasks: true,
                defaultPrivacyLevel: 'mask-user-input'
            };

            // Function to initialize Datadog
            function initializeDatadog() {
                // Check if we have valid tokens (not placeholder values)
                const hasValidTokens = DATADOG_CONFIG.clientToken &&
                                     DATADOG_CONFIG.applicationId &&
                                     DATADOG_CONFIG.clientToken !== 'pub_1234567890abcdef1234567890abcdef' &&
                                     DATADOG_CONFIG.applicationId !== '12345678-1234-1234-1234-123456789012';

                if (!hasValidTokens) {
                    console.warn('‚ö†Ô∏è Datadog tokens not configured - RUM not initialized');
                    console.log('üìù To enable Datadog RUM:');
                    console.log('   1. Get your Client Token from Datadog ‚Üí Organization Settings ‚Üí API Keys');
                    console.log('   2. Get your Application ID from Datadog ‚Üí RUM ‚Üí Applications');
                    console.log('   3. Replace the hardcoded values in index.html');
                    
                    // Create placeholder objects to prevent errors
                    window.DD_RUM = window.DD_RUM || {
                        init: () => {},
                        addAction: () => {},
                        addError: () => {},
                        addTiming: () => {},
                        setGlobalContextProperty: () => {},
                        startSessionReplayRecording: () => {}
                    };
                    window.DD_LOGS = window.DD_LOGS || {
                        init: () => {},
                        logger: {
                            info: () => {},
                            error: () => {},
                            warn: () => {}
                        }
                    };
                    return;
                }

                try {
                    // Initialize RUM
                    if (window.DD_RUM) {
                        window.DD_RUM.init(DATADOG_CONFIG);

                        window.DD_RUM.startSessionReplayRecording();

                        // Set global context
                        window.DD_RUM.setGlobalContextProperty('application_type', 'llm_demo');
                        window.DD_RUM.setGlobalContextProperty('deployment_method', 'static_hosting');
                        window.DD_RUM.setGlobalContextProperty('framework', 'vanilla_js');
                        window.DD_RUM.setGlobalContextProperty('demo_version', '1.0.0');
                    }

                    // Initialize Logs
                    if (window.DD_LOGS) {
                        window.DD_LOGS.init({
                            clientToken: DATADOG_CONFIG.clientToken,
                            site: DATADOG_CONFIG.site,
                            service: DATADOG_CONFIG.service,
                            env: DATADOG_CONFIG.env,
                            version: DATADOG_CONFIG.version,
                            sessionSampleRate: DATADOG_CONFIG.sessionSampleRate,
                            silentMultipleInit: true
                        });
                    }

                    console.log('‚úÖ Datadog RUM and Logs initialized successfully');
                    console.log('üìä RUM Configuration:', {
                        site: DATADOG_CONFIG.site,
                        service: DATADOG_CONFIG.service,
                        env: DATADOG_CONFIG.env,
                        version: DATADOG_CONFIG.version
                    });

                    // Track page load
                    if (window.DD_RUM) {
                        window.DD_RUM.addAction('page_loaded', {
                            page_type: 'llm_demo',
                            timestamp: new Date().toISOString(),
                            url: window.location.href,
                            user_agent: navigator.userAgent
                        });
                    }

                } catch (error) {
                    console.error('‚ùå Failed to initialize Datadog:', error);
                }
            }

            // Start initialization when DOM is ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', initializeDatadog);
            } else {
                initializeDatadog();
            }
        })();
    </script>
</head>
<body>
    <div class="container">
        <header>
            <h1>ü§ñ LLM Observability Demo</h1>
            <p>Comprehensive monitoring of AI-powered applications with Datadog</p>
        </header>

        <div class="mode-selector">
            <button class="mode-btn active" data-mode="chat">üí¨ Chat</button>
            <button class="mode-btn" data-mode="summarize">üìù Summarize</button>
            <button class="mode-btn" data-mode="codegen">üíª Code Gen</button>
        </div>

        <div class="main-content">
            <div class="chat-container" id="chatMode">
                <div class="chat-messages" id="chatMessages"></div>
                <div class="input-container">
                    <input type="text" id="chatInput" placeholder="Ask me anything..." />
                    <button id="sendBtn">Send</button>
                </div>
            </div>

            <div class="summarize-container hidden" id="summarizeMode">
                <div class="input-section">
                    <h3>Text Summarization</h3>
                    <textarea id="summarizeInput" placeholder="Paste your text here to summarize..."></textarea>
                    <button id="summarizeBtn">Summarize</button>
                </div>
                <div class="output-section">
                    <h3>Summary</h3>
                    <div id="summarizeOutput"></div>
                </div>
            </div>

            <div class="codegen-container hidden" id="codegenMode">
                <div class="input-section">
                    <h3>Code Generation</h3>
                    <textarea id="codegenInput" placeholder="Describe what code you want me to generate..."></textarea>
                    <button id="codegenBtn">Generate Code</button>
                </div>
                <div class="output-section">
                    <h3>Generated Code</h3>
                    <pre id="codegenOutput"></pre>
                </div>
            </div>
        </div>

        <div class="metrics-panel">
            <h3>üìä Session Metrics</h3>
            <div class="metrics-grid">
                <div class="metric">
                    <span class="metric-label">Tokens Used:</span>
                    <span class="metric-value" id="tokenCount">0</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Estimated Cost:</span>
                    <span class="metric-value" id="costEstimate">$0.00</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Requests:</span>
                    <span class="metric-value" id="requestCount">0</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Avg Response Time:</span>
                    <span class="metric-value" id="avgResponseTime">0ms</span>
                </div>
            </div>
        </div>

        <div class="config-panel">
            <h3>‚öôÔ∏è Configuration</h3>
            
            <div class="config-section">
                <h4>ü§ñ OpenAI Configuration</h4>
                <div class="config-item">
                    <label for="apiKey">OpenAI API Key:</label>
                    <input type="password" id="apiKey" placeholder="sk-..." />
                </div>
                <div class="config-item">
                    <label for="model">Model:</label>
                    <select id="model">
                        <option value="gpt-4o-mini">GPT-4o Mini</option>
                        <option value="gpt-4o">GPT-4o</option>
                        <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                    </select>
                </div>
            </div>

            <div class="config-section">
                <h4>üìä Datadog LLM Observability</h4>
                <div class="config-item">
                    <label for="ddApplicationId">Application ID:</label>
                    <input type="text" id="ddApplicationId" placeholder="YOUR_DATADOG_APPLICATION_ID" />
                </div>
                <div class="config-item">
                    <label for="ddClientToken">Client Token:</label>
                    <input type="password" id="ddClientToken" placeholder="YOUR_DATADOG_CLIENT_TOKEN" />
                </div>
                <div class="config-item">
                    <label for="ddSite">Site:</label>
                    <select id="ddSite">
                        <option value="datadoghq.com">US1 (datadoghq.com)</option>
                        <option value="datadoghq.eu">EU1 (datadoghq.eu)</option>
                        <option value="us3.datadoghq.com">US3 (us3.datadoghq.com)</option>
                        <option value="us5.datadoghq.com">US5 (us5.datadoghq.com)</option>
                        <option value="ap1.datadoghq.com">AP1 (ap1.datadoghq.com)</option>
                        <option value="custom">Custom Site</option>
                    </select>
                </div>
                <div class="config-item" id="customSiteContainer" style="display: none;">
                    <label for="ddCustomSite">Custom Site URL:</label>
                    <input type="text" id="ddCustomSite" placeholder="your-custom-site.datadoghq.com" />
                </div>
                <div class="config-item">
                    <label for="ddService">Service Name:</label>
                    <input type="text" id="ddService" placeholder="llm-observability-demo" />
                </div>
                <div class="config-item">
                    <label for="ddEnv">Environment:</label>
                    <select id="ddEnv">
                        <option value="production">Production</option>
                        <option value="staging">Staging</option>
                        <option value="development">Development</option>
                        <option value="test">Test</option>
                    </select>
                </div>
                <div class="config-item">
                    <label for="ddVersion">Version:</label>
                    <input type="text" id="ddVersion" placeholder="1.0.0" />
                </div>
            </div>

            <div class="config-section">
                <h4>üîß Advanced Datadog Settings</h4>
                <div class="config-item">
                    <label for="ddSessionSampleRate">Session Sample Rate (%):</label>
                    <input type="number" id="ddSessionSampleRate" min="0" max="100" value="100" />
                </div>
                <div class="config-item">
                    <label for="ddReplaySampleRate">Session Replay Sample Rate (%):</label>
                    <input type="number" id="ddReplaySampleRate" min="0" max="100" value="20" />
                </div>
                <div class="config-item">
                    <label>
                        <input type="checkbox" id="ddTrackUserInteractions" checked />
                        Track User Interactions
                    </label>
                </div>
                <div class="config-item">
                    <label>
                        <input type="checkbox" id="ddTrackResources" checked />
                        Track Resources
                    </label>
                </div>
                <div class="config-item">
                    <label>
                        <input type="checkbox" id="ddTrackLongTasks" checked />
                        Track Long Tasks
                    </label>
                </div>
            </div>

            <button id="saveConfig">Save Configuration</button>
            <button id="resetConfig">Reset to Defaults</button>
        </div>
    </div>

    <!-- Load our application scripts -->
    <script src="js/datadog.js"></script>
    <script src="js/openai.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
